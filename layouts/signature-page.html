{{ define "extra-head" }}
<script type="module">
  import Alpine from "https://unpkg.com/alpinejs@3.14.8/dist/module.esm.min.js";
  function fetcher(){
    return {
      url: '',
      buildURL() {
        this.url = `/app/build-signature?${new URLSearchParams(new FormData(this.$refs.form))}`;
      },
      init() {
        this.buildURL();
      }
    }
  }
  Alpine.data('fetcher', fetcher);
  Alpine.start();
</script>
{{ end }}
{{ define "body" }}
<div class="my-8 w-full bg-white max-w-screen-md font-sans rounded shadow p-4">
  <h1 class="text-2xl text-slate-500 font-bold">Gmail Signature for {{ .Email }}</h1>
  {{ with .Signature }}
    <h2 class="mt-4 text-xl font-bold">Current Signature</h2>
    <div class="mt-2">
      <iframe class="border border-black w-[475px] h-[300px] shadow" srcdoc="{{ . }}"></iframe>
    </div>
  {{ end }}
  <h2 class="mt-4 text-xl font-bold">Update Signature</h2>
  <div class="mt-2" x-data="fetcher">
    <div class="mt-2" :class="{ 'hidden': !url }">
      <iframe class="border border-black w-[475px] h-[300px] shadow" :src="url"></iframe>
      <span x-text="url"></span>
    </div>
    <form x-ref="form" @input.debounce="buildURL">
      <input name="email" value="{{ .Email }}" />

    </form>
    <form action="/app/signature" method="post">
      <input type="hidden" name="csrf" value="{{ .CSRF }}" />
      <input type="hidden" name="email" value="{{ .Email }}" />

      <label>
        Temporary debug signature field:
        <input name="signature" value="{{ .Signature }}" />
      </label>
      <button
        class="px-4 py-2 appearance-none shadow hover:shadow-lg rounded bg-[#009edb] hover:bg-[#0cb4eb] focus:outline-none focus:ring-2 focus:ring-black focus:ring-opacity-50 text-white uppercase tracking-wider"
      >
        Set signature
      </button>
    </form>
  </div>
  <form class="mt-8" action="/app/logout" method="post">
    <button
      class="px-4 py-2 appearance-none shadow hover:shadow-lg rounded bg-[#f00] hover:bg-[#d70000] focus:outline-none focus:ring-2 focus:ring-black focus:ring-opacity-50 text-white uppercase tracking-wider"
    >
      Log out
    </button>
  </form>
</div>
{{ end }}
